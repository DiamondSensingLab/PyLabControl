

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>src.gui.gui_scan_layout &mdash; PyLabControl 1.0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="PyLabControl 1.0.1 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> PyLabControl
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../project.html">PythonLab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../src/code.html">Code</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">PyLabControl</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>src.gui.gui_scan_layout</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for src.gui.gui_scan_layout</h1><div class="highlight"><pre>
<span></span><span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Experiment&#39;</span>

<span class="kn">import</span> <span class="nn">Queue</span>
<span class="kn">import</span> <span class="nn">json</span> <span class="kn">as</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">Image</span>
<span class="kn">import</span> <span class="nn">src.helper_functions.Meshing</span> <span class="kn">as</span> <span class="nn">Meshing</span>
<span class="kn">import</span> <span class="nn">src.helper_functions.reading_writing</span> <span class="kn">as</span> <span class="nn">rw</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="kn">as</span> <span class="nn">patches</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy.spatial</span>
<span class="kn">import</span> <span class="nn">src.scripts.ESR_many_NVs</span> <span class="kn">as</span> <span class="nn">ESR</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>
<span class="kn">from</span> <span class="nn">src.functions</span> <span class="kn">import</span> <span class="n">track_NVs</span> <span class="k">as</span> <span class="n">track</span>
<span class="kn">from</span> <span class="nn">src.hardware_modules</span> <span class="kn">import</span> <span class="n">PiezoController</span> <span class="k">as</span> <span class="n">PC</span>
<span class="kn">from</span> <span class="nn">src.scripts</span> <span class="kn">import</span> <span class="n">ZiControl_many_pts</span> <span class="k">as</span> <span class="n">ZIControl</span>
<span class="kn">from</span> <span class="nn">src.scripts</span> <span class="kn">import</span> <span class="n">set_focus</span> <span class="k">as</span> <span class="n">f</span>

<span class="kn">import</span> <span class="nn">src.scripts.auto_focus</span> <span class="kn">as</span> <span class="nn">AF</span>
<span class="kn">from</span> <span class="nn">src.gui</span> <span class="kn">import</span> <span class="n">GuiDeviceTriggers</span> <span class="k">as</span> <span class="n">DeviceTriggers</span>
<span class="kn">from</span> <span class="nn">src.gui</span> <span class="kn">import</span> <span class="n">PlotAPDCounts3</span> <span class="k">as</span> <span class="n">Cnts</span>
<span class="kn">from</span> <span class="nn">src.gui</span> <span class="kn">import</span> <span class="n">gui_custom_widgets</span> <span class="k">as</span> <span class="n">gui_cw</span>


<span class="c1"># This function should be called from the PYQT main loop. It implements all of the widgets in the gui</span>
<div class="viewcode-block" id="add_scan_layout"><a class="viewcode-back" href="../../../src/src.gui.gui_scan_layout.html#src.gui.gui_scan_layout.add_scan_layout">[docs]</a><span class="k">def</span> <span class="nf">add_scan_layout</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="n">vbox_main</span><span class="p">,</span> <span class="n">plotBox</span><span class="p">):</span>


    <span class="c1">##################################################################################</span>
    <span class="c1"># ADD Scan########################################################################</span>
    <span class="c1">##################################################################################</span>
    <span class="k">def</span> <span class="nf">display_shapes</span><span class="p">():</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Displays patches for roi, laser, grid, etc on image</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># ApplicationWindow.imPlot.axes.imshow(ApplicationWindow.imageData, extent = [-.05,.05,-.05,.05])</span>
        <span class="c1"># checks which patches are toggled on</span>
        <span class="k">if</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_roi</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">get_roi_patch</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_grid</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">get_grid_patches</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_line</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">get_line_patches</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_laser</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">get_dot_patch_laser</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_pt2</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">get_dot_patch_pt2</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">plot_nvs</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">get_dot_patches_nv_points</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_NVs</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">get_dot_patches_selected_points</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">patches</span><span class="o">==</span><span class="p">[]):</span>
            <span class="c1"># ApplicationWindow.imPlot.axes.add_collection(ApplicationWindow.patches)</span>
            <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_NV_labels</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">display_point_labels</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">reset_shapes</span><span class="p">():</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Removes current patches and regenerates them, to be called when anything changing what patches are needed</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">remove_patches</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
        <span class="n">display_shapes</span><span class="p">()</span>



    <span class="k">def</span> <span class="nf">display_point_labels</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Goes through list of chosen NVs and display number, corresponding to order ini which they will be processed</span>
<span class="sd">        :param ApplicationWindow:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">nv_num</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">nv_pt</span> <span class="ow">in</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">selected_points</span><span class="p">:</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">nv_pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nv_pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nv_num</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">nv_num</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">get_dot_patch_pt2</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        place yellow dot at pt_a and appends to patchlist</span>
<span class="sd">        :param ApplicationWindow:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">size</span><span class="p">,</span> <span class="n">pt_a</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">pt_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt_a</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="o">*</span><span class="n">size</span><span class="p">,</span> <span class="n">fc</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_dot_patches_nv_points</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        adds the previously selected points as patches to the image</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">size</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">nv_points</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="p">[</span><span class="n">patches</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">size</span><span class="p">,</span> <span class="n">fc</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">nv_points</span><span class="p">]:</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_dot_patches_selected_points</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        adds the previously selected points as patches to the image</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">size</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">selected_points</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="p">[</span><span class="n">patches</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">size</span><span class="p">,</span> <span class="n">fc</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">selected_points</span><span class="p">]:</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_dot_patch_laser</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        place yellow dot at pt_L, the location of the laser, and appends to patchlist</span>
<span class="sd">        :param ApplicationWindow:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">size</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">pt_L</span> <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">pt_L</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt_L</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">3</span><span class="o">*</span><span class="n">size</span><span class="p">,</span> <span class="n">fc</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_line_patches</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        generates xpts number of points between pt_a and pt_b</span>
<span class="sd">        :param ApplicationWindow:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">size</span><span class="p">,</span> <span class="n">pt_a</span><span class="p">,</span> <span class="n">pt_b</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span><span class="n">_</span>  <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">Meshing</span><span class="o">.</span><span class="n">get_points_along_line</span><span class="p">(</span><span class="n">pt_a</span><span class="p">,</span> <span class="n">pt_b</span><span class="p">,</span> <span class="n">xpts</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="p">[</span><span class="n">patches</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">size</span><span class="p">,</span> <span class="n">fc</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]:</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_grid_patches</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        generates an xpts x ypts grid of white circles, using pt_a and pt_b as the corners for a straight grid,  or</span>
<span class="sd">                pt_a and pt_b to define a line and pt_c to define a distance from that line for an angled grid</span>
<span class="sd">        :param ApplicationWindow:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">size</span><span class="p">,</span> <span class="n">pt_a</span><span class="p">,</span> <span class="n">pt_b</span><span class="p">,</span> <span class="n">pt_c</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span><span class="n">_</span>  <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
        <span class="c1"># checks if grid should be straight vertical/horizontal or angled</span>
        <span class="k">if</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_angled_grid</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">Meshing</span><span class="o">.</span><span class="n">get_points_on_a_grid_angled</span><span class="p">(</span><span class="n">pt_a</span><span class="p">,</span> <span class="n">pt_b</span><span class="p">,</span> <span class="n">pt_c</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">Meshing</span><span class="o">.</span><span class="n">get_points_on_a_grid</span><span class="p">(</span><span class="n">pt_a</span><span class="p">,</span> <span class="n">pt_b</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="p">[</span><span class="n">patches</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">size</span><span class="p">,</span> <span class="n">fc</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]:</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_roi_patch</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generates a red rectangular box around the region of interest</span>
<span class="sd">        :param ApplicationWindow:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">size</span><span class="p">,</span> <span class="n">pt_a</span><span class="p">,</span> <span class="n">pt_b</span> <span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>

        <span class="n">center</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">Meshing</span><span class="o">.</span><span class="n">two_pts_to_center_size</span><span class="p">(</span><span class="n">pt_a</span><span class="p">,</span> <span class="n">pt_b</span><span class="p">)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">w</span> <span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="o">/</span><span class="mf">2.</span><span class="p">),</span>
                           <span class="n">width</span> <span class="o">=</span> <span class="n">w</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">h</span> <span class="p">,</span> <span class="n">fc</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span> <span class="p">,</span> <span class="n">ec</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">))</span>

        
    <span class="k">def</span> <span class="nf">choosing_points</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Enters an interactive mode in which clicking on points on the plot selects the nearest NV, in order to run ESR on</span>
<span class="sd">        many NVs</span>
<span class="sd">        :param ApplicationWindow:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_select_NVs</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()):</span>
            <span class="k">def</span> <span class="nf">select_point</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">):</span>
                <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                Selects circular feature (NV) nearest to click, adding it to an array and plotting a red dot if not</span>
<span class="sd">                previously selected, or removing it and replotting a blue dot if currently selected</span>
<span class="sd">                :param event: event object with location of click on plot</span>
<span class="sd">                :param coordinates: current list of nv coordinates, which is added to here</span>
<span class="sd">                &#39;&#39;&#39;</span>
                <span class="c1"># Check for click out of plot range</span>
                <span class="k">if</span><span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="o">==</span> <span class="bp">None</span><span class="p">)):</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">])</span>
                        <span class="n">tree</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">KDTree</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
                        <span class="n">_</span><span class="p">,</span><span class="n">i</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
                        <span class="n">nv_pt</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                        <span class="c1"># removes NV if previously selected</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">nv_pt</span> <span class="ow">in</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">selected_points</span><span class="p">):</span>
                            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">selected_points</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">nv_pt</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">circ</span> <span class="ow">in</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">esr_select_patches</span><span class="p">:</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">nv_pt</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">circ</span><span class="o">.</span><span class="n">center</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                                    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">esr_select_patches</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
                                    <span class="n">circ</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                                    <span class="k">break</span>
                        <span class="c1"># adds NV if not previously selected</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">selected_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nv_pt</span><span class="p">)</span>
                            <span class="n">size</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
                            <span class="n">circ</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">nv_pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nv_pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">size</span><span class="p">,</span> <span class="n">fc</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
                            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
                            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">esr_select_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
                        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

            <span class="k">def</span> <span class="nf">find_pts</span><span class="p">(</span><span class="n">voltage_range</span><span class="p">,</span> <span class="n">numPts</span><span class="p">):</span>
                <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                Finds all possible circular features (NVs) in image that can be selected</span>
<span class="sd">                :param voltage_range: x range in V of plot</span>
<span class="sd">                :param numPts: number of xpts in plot</span>
<span class="sd">                &#39;&#39;&#39;</span>
                <span class="k">if</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">is_choosing_points</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">select_point</span><span class="p">)</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">plot_nvs</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">is_choosing_points</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s2">&quot;Choose NVs for ESR&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="c1"># voltage range and numPts used for scaling to find correct feature size for circles</span>
                <span class="n">coordinates</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">locate_NVs</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imageData</span><span class="p">,</span> <span class="n">voltage_range</span><span class="p">,</span> <span class="n">numPts</span><span class="p">)</span>
                <span class="n">coordinates</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">xPts</span><span class="p">,</span> <span class="n">yPts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
                <span class="n">nv_roi</span> <span class="o">=</span> <span class="n">Meshing</span><span class="o">.</span><span class="n">two_pts_to_roi</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">xPts</span><span class="p">,</span> <span class="n">yPts</span><span class="p">)</span>
                <span class="n">coordinates_in_volt</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">pixel_to_voltage</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imageData</span><span class="p">,</span> <span class="n">nv_roi</span><span class="p">)</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">nv_points</span> <span class="o">=</span> <span class="n">coordinates_in_volt</span>
                <span class="n">display_shapes</span><span class="p">()</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">esr_select_patches</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">def</span> <span class="nf">choose_subset</span><span class="p">():</span>
                <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                Activates &#39;click to select NVs&#39; mode, then when completed saves current image with patches at selected</span>
<span class="sd">                NVs and removes nv patches from display image</span>
<span class="sd">                &#39;&#39;&#39;</span>
                <span class="n">point_selected</span> <span class="o">=</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">select_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">nv_points</span><span class="p">))</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">selected_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">is_choosing_points</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">while</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">is_choosing_points</span><span class="p">:</span>
                    <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">05</span><span class="p">)</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="n">select_point</span><span class="p">)</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
                <span class="n">dirpath</span> <span class="o">=</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_save_image_location</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H-%M-%S&quot;</span><span class="p">)</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">dirpath</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">start_time</span>
                <span class="n">filepathJPG</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filepathJPG</span><span class="p">),</span> <span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;jpg&#39;</span><span class="p">)</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">plot_nvs</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">for</span> <span class="n">circ</span> <span class="ow">in</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">esr_select_patches</span><span class="p">:</span>
                    <span class="n">circ</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="n">reset_shapes</span><span class="p">()</span>

            <span class="n">voltage_range</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_x</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_x</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
            <span class="n">numPts</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1_x_pts</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="n">find_pts</span><span class="p">(</span><span class="n">voltage_range</span><span class="p">,</span> <span class="n">numPts</span><span class="p">)</span>
            <span class="n">choose_subset</span><span class="p">()</span>



        <span class="k">else</span><span class="p">:</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">is_choosing_points</span> <span class="o">=</span> <span class="bp">False</span>


        <span class="c1"># df = pd.DataFrame(ApplicationWindow.esr_NVs)</span>
        <span class="c1"># dfimg = pd.DataFrame(ApplicationWindow.imageData)</span>
        <span class="c1"># dirpath = ApplicationWindow.esrSaveLoc.text()</span>
        <span class="c1"># start_time = time.strftime(&quot;%Y-%m-%d_%H-%M-%S&quot;)</span>
        <span class="c1"># filepath = dirpath + &quot;\\&quot; + start_time</span>
        <span class="c1"># filepathCSV = filepath + &#39;.csv&#39;</span>
        <span class="c1"># filepathImg = filepath + &#39;baselineimg.csv&#39;</span>
        <span class="c1"># filepathJPG = filepath + &#39;.jpg&#39;</span>
        <span class="c1"># filepathRoI = filepath + &#39;.roi&#39;</span>
        <span class="c1"># df.to_csv(filepathCSV, index = False, header=False)</span>
        <span class="c1"># dfimg.to_csv(filepathImg, index = False, header=False)</span>
        <span class="c1"># ApplicationWindow.imPlot.fig.savefig(str(filepathJPG), format = &#39;jpg&#39;)</span>
        <span class="c1"># ApplicationWindow.saveRoI(ApplicationWindow.RoI, filepathRoI)</span>
        <span class="c1"># ApplicationWindow.esrReadLoc.setText(filepath)</span>
        <span class="c1"># ApplicationWindow.statusBar().clearMessage()</span>
        <span class="c1"># ApplicationWindow.esr_running = False</span>



    <span class="c1">#def end_choosing_points(ApplicationWindow):</span>
    <span class="c1">#    ApplicationWindow.is_choosing_points = False</span>
    <span class="c1">#    print(ApplicationWindow.esr_NVs)</span>
        
        
        
        
    <span class="k">def</span> <span class="nf">remove_patches</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Removes all patches from the main plot in ApplicationWindow</span>
<span class="sd">        :param ApplicationWindow:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">patches</span><span class="o">==</span><span class="p">[]):</span>
            <span class="k">print</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">patches</span>
            <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
                <span class="c1"># patch.remove() randomly fails for unknown reason. This skips that failed patch. No adverse issues</span>
                <span class="c1"># seem to occur</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">patch</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">patches</span><span class="o">=</span><span class="p">[]</span>



    <span class="k">def</span> <span class="nf">set_laser</span><span class="p">(</span><span class="n">ptL</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Sets laser to input parameter point or, if none given, to point 2a</span>
<span class="sd">        :param ptL: Point (x,y) to set laser to</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">ptL</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">xL</span> <span class="o">=</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2a_x</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">yL</span> <span class="o">=</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2a_y</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xL</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptL</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">yL</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptL</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_laser_x</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">xL</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_laser_y</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">yL</span><span class="p">)</span>
        <span class="n">DeviceTriggers</span><span class="o">.</span><span class="n">setDaqPt</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">xL</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">yL</span><span class="p">))</span>

        <span class="n">reset_shapes</span><span class="p">()</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s2">&quot;Galvo Position Updated&quot;</span><span class="p">,</span><span class="mi">2000</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copy_scan_params</span><span class="p">():</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Copy scan parameters to clipboard to easily paste them into readme file</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">clipboard</span><span class="p">()</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">cb</span><span class="o">.</span><span class="n">Clipboard</span> <span class="p">)</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;xVmin = &quot;</span> <span class="o">+</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2a_x</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">yVmin = &quot;</span> <span class="o">+</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2a_y</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">xVmax = &quot;</span> <span class="o">+</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2b_x</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">yVmax = &quot;</span> <span class="o">+</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2b_y</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">xPts = &quot;</span> <span class="o">+</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1_x_pts</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">yPts = &quot;</span> <span class="o">+</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1_y_pts</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">timerPerPt = &quot;</span> <span class="o">+</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_time_per_pt</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="n">cb</span><span class="o">.</span><span class="n">Clipboard</span><span class="p">)</span>

    <span class="c1">##################################################################################</span>
    <span class="c1"># ADD EXECUTE ####################################################################</span>
    <span class="c1">##################################################################################</span>






    <span class="k">def</span> <span class="nf">add_execute</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">row_start</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column_start</span> <span class="o">=</span>  <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds widgets to grid relating to executiing scripts</span>
<span class="sd">        :param grid: Overall ui grid containing regions of UI elements</span>
<span class="sd">        :param row_start: index of first row element</span>
<span class="sd">        :param column_start: index of first column element</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_execute</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;execute&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_execute</span><span class="p">,</span><span class="n">row_start</span><span class="p">,</span><span class="n">column_start</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_execute</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="c1"># Add new scripts to be executed here</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_execute</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="s1">&#39;ESR (chosen NVs)&#39;</span><span class="p">,</span> <span class="s1">&#39;ESR (grid)&#39;</span><span class="p">,</span> <span class="s1">&#39;ESR (point)&#39;</span><span class="p">,</span> <span class="s1">&#39;AutoFocus&#39;</span><span class="p">,</span> <span class="s1">&#39;AutoFocus (attocube)&#39;</span><span class="p">,</span> <span class="s1">&#39;AutoFocus (mean)&#39;</span><span class="p">,</span> <span class="s1">&#39;AutoFocus (mean, grid)&#39;</span><span class="p">,</span> <span class="s1">&#39;Counter&#39;</span><span class="p">,</span> <span class="s1">&#39;Get Distance&#39;</span><span class="p">,</span> <span class="s1">&#39;ZI Frequency Sweep (point)&#39;</span><span class="p">,</span> <span class="s1">&#39;ZI Frequency Sweep (grid)&#39;</span><span class="p">,</span> <span class="s1">&#39;reset scan range&#39;</span><span class="p">])</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_execute</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">change_script</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_execute</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">column_start</span><span class="p">)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_settings</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;script settings&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_settings</span><span class="p">,</span><span class="n">row_start</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">change_script_path</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">))</span>
        <span class="c1"># ApplicationWindow.path_script.setText(&#39;Z:\\Lab\\Cantilever\\Measurements&#39;)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_execute_script</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;run script&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_execute_script</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">execute_script</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_execute_script</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_stop_script</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;stop script&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_stop_script</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">stop_script</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_stop_script</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">selected_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>


        <span class="k">def</span> <span class="nf">buttonRecordData_clicked</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>
            <span class="n">script_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_execute</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">script_path</span> <span class="o">=</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">parameters_paths_scripts</span><span class="p">[</span><span class="n">script_name</span><span class="p">]</span>
            <span class="n">script_path</span> <span class="o">=</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">parameters_paths_scripts</span><span class="p">[</span><span class="n">script_name</span><span class="p">]</span>
            <span class="c1"># ApplicationWindow.statusBar().showMessage(ApplicationWindow.cmb_execute.currentText(),1000)</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">script_path</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">change_script</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Changes script to be executed based on current text in box</span>
<span class="sd">            :param ApplicationWindow:</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">script_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_execute</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">script_path</span> <span class="o">=</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">parameters_paths_scripts</span><span class="p">[</span><span class="n">script_name</span><span class="p">]</span>
            <span class="c1"># ApplicationWindow.statusBar().showMessage(ApplicationWindow.cmb_execute.currentText(),1000)</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">script_path</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">change_script_path</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Changes path to script to be executed</span>
<span class="sd">            :param ApplicationWindow:</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">script_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_execute</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">script_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">parameters_paths_scripts</span><span class="p">[</span><span class="n">script_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">script_path</span>

        <span class="c1"># def execute_script(ApplicationWindow):</span>
        <span class="c1">#</span>
        <span class="c1">#     script_name = str(ApplicationWindow.cmb_execute.currentText())</span>
        <span class="c1">#</span>
        <span class="c1">#     if script_name == &#39;ESR&#39;:</span>
        <span class="c1">#</span>
        <span class="c1">#         ApplicationWindow.statusBar().showMessage(&#39;starting esr script&#39;,1000)</span>
        <span class="c1">#         load_parameter</span>
        <span class="c1">#</span>
        <span class="c1">#         DeviceTriggers.runESR(float(ApplicationWindow.rfPower.text),float(ApplicationWindow.freqMin.text),float(ApplicationWindow.freqMax.text),float(ApplicationWindow.numPtsESR.text), ApplicationWindow.esrQueue)</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1">#         ApplicationWindow.path_script.setText(ApplicationWindow.parameters_paths_scripts[])</span>

        <span class="k">def</span> <span class="nf">execute_script</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            </span>
<span class="sd">            :param ApplicationWindow:</span>
<span class="sd">            :return:</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">script_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_execute</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">script_path</span> <span class="o">=</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">parameters_paths_scripts</span><span class="p">[</span><span class="n">script_name</span><span class="p">]</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s1">&#39;running {:s} with {:s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_name</span><span class="p">,</span> <span class="n">script_path</span><span class="p">),</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">script_path</span><span class="p">)</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">script_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>

            <span class="k">print</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">script_name</span> <span class="o">==</span> <span class="s1">&#39;ESR (chosen NVs)&#39;</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">pt_a2</span><span class="p">,</span> <span class="n">pt_b2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
                <span class="n">esr_param</span> <span class="o">=</span> <span class="n">ESR</span><span class="o">.</span><span class="n">ESR_load_param</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">roi_focus</span> <span class="o">=</span> <span class="n">Meshing</span><span class="o">.</span><span class="n">two_pts_to_roi</span><span class="p">(</span><span class="n">pt_a2</span><span class="p">,</span> <span class="n">pt_b2</span><span class="p">)</span>
                <span class="k">print</span> <span class="s1">&#39;ESR (chosen NVs)&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">selected_points</span><span class="p">:</span>
                    <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">,</span> <span class="s2">&quot;No NVs Error&quot;</span><span class="p">,</span><span class="s2">&quot;You must choose NVs before running this ESR script&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ESR</span><span class="o">.</span><span class="n">ESR_map_focus</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">selected_points</span><span class="p">,</span> <span class="n">roi_focus</span><span class="p">,</span> <span class="n">esr_param</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">esrPlot</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">script_name</span> <span class="o">==</span> <span class="s1">&#39;ESR (grid)&#39;</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">pt_a2</span><span class="p">,</span> <span class="n">pt_b2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_angled_grid</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="n">points</span> <span class="o">=</span> <span class="n">Meshing</span><span class="o">.</span><span class="n">get_points_on_a_grid_angled</span><span class="p">(</span><span class="n">pt_a2</span><span class="p">,</span> <span class="n">pt_b2</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">points</span> <span class="o">=</span> <span class="n">Meshing</span><span class="o">.</span><span class="n">get_points_on_a_grid</span><span class="p">(</span><span class="n">pt_a2</span><span class="p">,</span> <span class="n">pt_b2</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">)</span>
                <span class="n">roi_focus</span> <span class="o">=</span> <span class="n">Meshing</span><span class="o">.</span><span class="n">two_pts_to_roi</span><span class="p">(</span><span class="n">pt_a2</span><span class="p">,</span> <span class="n">pt_b2</span><span class="p">)</span>

                <span class="n">esr_param</span> <span class="o">=</span> <span class="n">ESR</span><span class="o">.</span><span class="n">ESR_load_param</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="k">print</span> <span class="s1">&#39;ESR (grid)&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">esr_param</span> <span class="o">==</span> <span class="p">{}:</span>
                    <span class="n">ESR</span><span class="o">.</span><span class="n">ESR_map_focus</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">roi_focus</span><span class="p">,</span> <span class="n">esr_param</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">esrPlot</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">script_name</span> <span class="o">==</span> <span class="s1">&#39;ESR (point)&#39;</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">pt_a2</span><span class="p">,</span> <span class="n">pt_b2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
                <span class="n">esr_param</span> <span class="o">=</span> <span class="n">ESR</span><span class="o">.</span><span class="n">ESR_load_param</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">roi_focus</span> <span class="o">=</span> <span class="n">Meshing</span><span class="o">.</span><span class="n">two_pts_to_roi</span><span class="p">(</span><span class="n">pt_a2</span><span class="p">,</span> <span class="n">pt_b2</span><span class="p">)</span>
                <span class="k">print</span> <span class="s1">&#39;ESR (point)&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">esr_param</span> <span class="o">==</span> <span class="p">{}:</span>
                    <span class="n">ESR</span><span class="o">.</span><span class="n">ESR_map</span><span class="p">([</span><span class="n">pt_a2</span><span class="p">],</span> <span class="n">esr_param</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">esrPlot</span><span class="p">,</span> <span class="n">queue</span> <span class="o">=</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">script_queue</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">script_name</span> <span class="o">==</span> <span class="s1">&#39;AutoFocus&#39;</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;AutoFocus&#39;</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">pt_a</span><span class="p">,</span> <span class="n">pt_b</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
                <span class="n">roi_focus</span> <span class="o">=</span> <span class="n">Meshing</span><span class="o">.</span><span class="n">two_pts_to_roi</span><span class="p">(</span><span class="n">pt_a</span><span class="p">,</span> <span class="n">pt_b</span><span class="p">)</span>
                <span class="n">af_parameter</span> <span class="o">=</span> <span class="n">AF</span><span class="o">.</span><span class="n">AF_load_param</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">af_parameter</span> <span class="o">==</span> <span class="p">{}:</span>
                    <span class="c1">#voltage_focus = AF.autofocus_RoI(af_parameter, roi_focus)</span>
                    <span class="n">voltage_focus</span> <span class="o">=</span> <span class="n">AF</span><span class="o">.</span><span class="n">autofocus_RoI</span><span class="p">(</span><span class="n">af_parameter</span><span class="p">,</span> <span class="n">roi_focus</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">piezo</span><span class="p">,</span> <span class="n">focPlot</span><span class="o">=</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">focPlot</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">script_queue</span><span class="p">)</span>
                    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s1">&#39;new focus {:0.3f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage_focus</span><span class="p">),</span><span class="mi">2000</span><span class="p">)</span>
                    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_focus_voltage</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;{:0.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage_focus</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">script_name</span> <span class="o">==</span> <span class="s1">&#39;AutoFocus (attocube)&#39;</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;AutoFocus (attocube)&#39;</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">pt_a</span><span class="p">,</span> <span class="n">pt_b</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
                <span class="n">roi_focus</span> <span class="o">=</span> <span class="n">Meshing</span><span class="o">.</span><span class="n">two_pts_to_roi</span><span class="p">(</span><span class="n">pt_a</span><span class="p">,</span> <span class="n">pt_b</span><span class="p">)</span>
                <span class="n">af_parameter</span> <span class="o">=</span> <span class="n">AF</span><span class="o">.</span><span class="n">AF_load_param_grid</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">af_parameter</span> <span class="o">==</span> <span class="p">{}:</span>
                    <span class="c1">#voltage_focus = AF.autofocus_RoI(af_parameter, roi_focus)</span>
                    <span class="n">voltage_focus</span> <span class="o">=</span> <span class="n">AF</span><span class="o">.</span><span class="n">autofocus_RoI_attocube</span><span class="p">(</span><span class="n">af_parameter</span><span class="p">,</span> <span class="n">roi_focus</span><span class="p">,</span> <span class="n">focPlot</span><span class="o">=</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">focPlot</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">script_queue</span><span class="p">)</span>
                    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s1">&#39;new focus {:0.3f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage_focus</span><span class="p">),</span><span class="mi">2000</span><span class="p">)</span>
                    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_focus_voltage</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;{:0.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage_focus</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">script_name</span> <span class="o">==</span> <span class="s1">&#39;AutoFocus (mean)&#39;</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;AutoFocus (mean)&#39;</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">pt_a</span><span class="p">,</span> <span class="n">pt_b</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
                <span class="n">roi_focus</span> <span class="o">=</span> <span class="n">Meshing</span><span class="o">.</span><span class="n">two_pts_to_roi</span><span class="p">(</span><span class="n">pt_a</span><span class="p">,</span> <span class="n">pt_b</span><span class="p">)</span>
                <span class="n">af_parameter</span> <span class="o">=</span> <span class="n">AF</span><span class="o">.</span><span class="n">AF_load_param</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">af_parameter</span> <span class="o">==</span> <span class="p">{}:</span>
                    <span class="c1">#voltage_focus = AF.autofocus_RoI(af_parameter, roi_focus)</span>
                    <span class="n">voltage_focus</span> <span class="o">=</span> <span class="n">AF</span><span class="o">.</span><span class="n">autofocus_RoI_mean</span><span class="p">(</span><span class="n">af_parameter</span><span class="p">,</span> <span class="n">roi_focus</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">piezo</span><span class="p">,</span> <span class="n">focPlot</span><span class="o">=</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">focPlot</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">script_queue</span><span class="p">)</span>
                    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s1">&#39;new focus {:0.3f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage_focus</span><span class="p">),</span><span class="mi">2000</span><span class="p">)</span>
                    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_focus_voltage</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;{:0.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage_focus</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">script_name</span> <span class="o">==</span> <span class="s1">&#39;AutoFocus (mean, grid)&#39;</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">pt_a2</span><span class="p">,</span> <span class="n">pt_b2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_angled_grid</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="n">points</span> <span class="o">=</span> <span class="n">Meshing</span><span class="o">.</span><span class="n">get_points_on_a_grid_angled</span><span class="p">(</span><span class="n">pt_a2</span><span class="p">,</span> <span class="n">pt_b2</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">points</span> <span class="o">=</span> <span class="n">Meshing</span><span class="o">.</span><span class="n">get_points_on_a_grid</span><span class="p">(</span><span class="n">pt_a2</span><span class="p">,</span> <span class="n">pt_b2</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">)</span>
                <span class="n">roi_focus</span> <span class="o">=</span> <span class="n">Meshing</span><span class="o">.</span><span class="n">two_pts_to_roi</span><span class="p">(</span><span class="n">pt_a2</span><span class="p">,</span> <span class="n">pt_b2</span><span class="p">)</span>

                <span class="n">af_parameter</span> <span class="o">=</span> <span class="n">AF</span><span class="o">.</span><span class="n">AF_load_param_grid</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="k">print</span> <span class="s1">&#39;AutoFocus (mean, grid)&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">af_parameter</span> <span class="o">==</span> <span class="p">{}:</span>
                    <span class="n">dirpath</span> <span class="o">=</span> <span class="n">af_parameter</span><span class="p">[</span><span class="s1">&#39;AF_path&#39;</span><span class="p">]</span>
                    <span class="n">tag</span> <span class="o">=</span> <span class="n">af_parameter</span><span class="p">[</span><span class="s1">&#39;AF_tag&#39;</span><span class="p">]</span>
                    <span class="n">tag</span> <span class="o">=</span> <span class="n">af_parameter</span><span class="p">[</span><span class="s1">&#39;AF_tag&#39;</span><span class="p">]</span>
                    <span class="n">rw</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">tag</span> <span class="o">+</span> <span class="s1">&#39;ptarray&#39;</span><span class="p">)</span>
                    <span class="n">save_settings_exp</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
                    <span class="n">AF</span><span class="o">.</span><span class="n">autofocus_ROI_mean_map</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">af_parameter</span><span class="p">,</span> <span class="n">roi_focus</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">piezo</span><span class="p">,</span> <span class="n">focPlot</span><span class="o">=</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">focPlot</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">script_queue</span><span class="p">,</span> <span class="n">imPlot</span><span class="o">=</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="p">)</span>


            <span class="k">elif</span> <span class="n">script_name</span> <span class="o">==</span> <span class="s1">&#39;Counter&#39;</span><span class="p">:</span>
                <span class="n">cnts_parameter</span> <span class="o">=</span> <span class="n">Cnts</span><span class="o">.</span><span class="n">counter_load_param</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="c1">#counter = Cnts.PlotAPD(sampleRate=float(cnts_parameter[&#39;sample_rate&#39;]), timePerPt=float(cnts_parameter[&#39;time_per_pt&#39;]), canvas = ApplicationWindow.esrPlot)</span>
                <span class="n">counter</span> <span class="o">=</span> <span class="n">Cnts</span><span class="o">.</span><span class="n">PlotAPD</span><span class="p">(</span><span class="n">canvas</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span>
                <span class="n">counter</span><span class="o">.</span><span class="n">startPlot</span><span class="p">(</span><span class="n">queue</span> <span class="o">=</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">script_queue</span><span class="p">)</span>


            <span class="k">elif</span> <span class="n">script_name</span> <span class="o">==</span> <span class="s1">&#39;Get Distance&#39;</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Get Distance&#39;</span><span class="p">)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">pt_a</span><span class="p">,</span> <span class="n">pt_b</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
                <span class="n">dist_params</span> <span class="o">=</span> <span class="n">rw</span><span class="o">.</span><span class="n">load_json</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
                <span class="n">roi_focus</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;zo&quot;</span><span class="p">:</span> <span class="n">dist_params</span><span class="p">[</span><span class="s1">&#39;zo&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;dz&quot;</span><span class="p">:</span> <span class="n">dist_params</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;zPts&quot;</span><span class="p">:</span> <span class="n">dist_params</span><span class="p">[</span><span class="s1">&#39;zPts&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;xyPts&quot;</span><span class="p">:</span> <span class="n">dist_params</span><span class="p">[</span><span class="s1">&#39;xyPts&#39;</span><span class="p">]</span>
                <span class="p">}</span>
                <span class="n">roi_a</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;xo&quot;</span><span class="p">:</span> <span class="n">pt_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s2">&quot;yo&quot;</span><span class="p">:</span> <span class="n">pt_a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;dx&quot;</span><span class="p">:</span> <span class="n">dist_params</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;dy&quot;</span><span class="p">:</span> <span class="n">dist_params</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">],</span>
                <span class="p">}</span>
                <span class="n">roi_b</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;xo&quot;</span><span class="p">:</span> <span class="n">pt_b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s2">&quot;yo&quot;</span><span class="p">:</span> <span class="n">pt_b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;dx&quot;</span><span class="p">:</span> <span class="n">dist_params</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;dy&quot;</span><span class="p">:</span> <span class="n">dist_params</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">],</span>
                <span class="p">}</span>
                <span class="n">dirpath</span> <span class="o">=</span> <span class="n">dist_params</span><span class="p">[</span><span class="s1">&#39;dirpath&#39;</span><span class="p">]</span>
                <span class="n">tag_a</span> <span class="o">=</span> <span class="n">dist_params</span><span class="p">[</span><span class="s1">&#39;tag_a&#39;</span><span class="p">]</span>
                <span class="n">tag_b</span> <span class="o">=</span> <span class="n">dist_params</span><span class="p">[</span><span class="s1">&#39;tag_b&#39;</span><span class="p">]</span>


                <span class="k">if</span> <span class="ow">not</span> <span class="n">dist_params</span> <span class="o">==</span> <span class="p">{}:</span>
                    <span class="n">init_focus</span> <span class="o">=</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_focus_voltage</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">voltage_data</span><span class="p">,</span> <span class="n">y_data</span> <span class="o">=</span> <span class="n">AF</span><span class="o">.</span><span class="n">autofocus_RoI</span><span class="p">(</span><span class="n">dist_params</span><span class="p">,</span> <span class="n">roi_a</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">piezo</span><span class="p">,</span> <span class="n">return_data</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="n">rw</span><span class="o">.</span><span class="n">save_data</span><span class="p">([</span><span class="n">voltage_data</span><span class="p">,</span><span class="n">y_data</span><span class="p">],</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">tag_a</span><span class="p">)</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">voltage_data</span><span class="p">,</span> <span class="n">y_data</span> <span class="o">=</span> <span class="n">AF</span><span class="o">.</span><span class="n">autofocus_RoI</span><span class="p">(</span><span class="n">dist_params</span><span class="p">,</span> <span class="n">roi_b</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">piezo</span><span class="p">,</span> <span class="n">return_data</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="n">rw</span><span class="o">.</span><span class="n">save_data</span><span class="p">([</span><span class="n">voltage_data</span><span class="p">,</span><span class="n">y_data</span><span class="p">],</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">tag_b</span><span class="p">)</span>

                    <span class="n">PC</span><span class="o">.</span><span class="n">MDT693B</span><span class="p">()</span><span class="o">.</span><span class="n">setVoltage</span><span class="p">(</span><span class="n">init_focus</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">script_name</span> <span class="o">==</span> <span class="s1">&#39;ZI Frequency Sweep (point)&#39;</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">pt_a2</span><span class="p">,</span> <span class="n">pt_b2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
                <span class="n">ZI_param</span> <span class="o">=</span> <span class="n">ZIControl</span><span class="o">.</span><span class="n">ZI_load_param</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="k">print</span> <span class="s1">&#39;ZI Frequency Sweep (point)&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ZI_param</span> <span class="o">==</span> <span class="p">{}:</span>
                    <span class="n">ZIControl</span><span class="o">.</span><span class="n">ZI_map</span><span class="p">([</span><span class="n">pt_a2</span><span class="p">],</span> <span class="n">ZI_param</span><span class="p">,</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">esrPlot</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">esrPlot</span><span class="p">)</span>



            <span class="k">elif</span> <span class="n">script_name</span> <span class="o">==</span> <span class="s1">&#39;ZI Frequency Sweep (grid)&#39;</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">pt_a2</span><span class="p">,</span> <span class="n">pt_b2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
                <span class="n">points</span> <span class="o">=</span> <span class="n">Meshing</span><span class="o">.</span><span class="n">get_points_on_a_grid</span><span class="p">(</span><span class="n">pt_a2</span><span class="p">,</span> <span class="n">pt_b2</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">)</span>
                <span class="n">roi_focus</span> <span class="o">=</span> <span class="n">Meshing</span><span class="o">.</span><span class="n">two_pts_to_roi</span><span class="p">(</span><span class="n">pt_a2</span><span class="p">,</span> <span class="n">pt_b2</span><span class="p">)</span>

                <span class="n">ZI_param</span> <span class="o">=</span> <span class="n">ZIControl</span><span class="o">.</span><span class="n">ZI_load_param</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="k">print</span> <span class="s1">&#39;ZI Frequency Sweep (grid)&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ZI_param</span> <span class="o">==</span> <span class="p">{}:</span>
                    <span class="n">ZIControl</span><span class="o">.</span><span class="n">ZI_map_focus</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">roi_focus</span><span class="p">,</span> <span class="n">ZI_param</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">esrPlot</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">script_name</span> <span class="o">==</span> <span class="s1">&#39;reset scan range&#39;</span><span class="p">:</span>

                <span class="k">def</span> <span class="nf">is_scan_range_param</span><span class="p">(</span><span class="n">myjson</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">json_object</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">myjson</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">False</span>

                    <span class="k">assert</span> <span class="s1">&#39;pt_1a_x&#39;</span> <span class="ow">in</span> <span class="n">json_object</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                    <span class="k">assert</span> <span class="s1">&#39;pt_1a_y&#39;</span> <span class="ow">in</span> <span class="n">json_object</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                    <span class="k">assert</span> <span class="s1">&#39;pt_1b_x&#39;</span> <span class="ow">in</span> <span class="n">json_object</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                    <span class="k">assert</span> <span class="s1">&#39;pt_1b_y&#39;</span> <span class="ow">in</span> <span class="n">json_object</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                    <span class="k">assert</span> <span class="s1">&#39;pt_1_x&#39;</span> <span class="ow">in</span> <span class="n">json_object</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                    <span class="k">assert</span> <span class="s1">&#39;pt_1_y&#39;</span> <span class="ow">in</span> <span class="n">json_object</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                    <span class="k">return</span> <span class="bp">True</span>

                <span class="n">param_txt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">is_scan_range_param</span><span class="p">(</span><span class="n">param_txt</span><span class="p">):</span>
                    <span class="n">param</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">param_txt</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;pt_1a_x&quot;</span><span class="p">:</span> <span class="s2">&quot;-0.4&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;pt_1a_y&quot;</span><span class="p">:</span> <span class="s2">&quot;-0.4&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;pt_1b_x&quot;</span><span class="p">:</span> <span class="s2">&quot;0.4&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;pt_1b_y&quot;</span><span class="p">:</span> <span class="s2">&quot;0.4&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;pt_1_x&quot;</span><span class="p">:</span> <span class="s2">&quot;120&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;pt_1_y&quot;</span><span class="p">:</span> <span class="s2">&quot;120&quot;</span>
                    <span class="p">}</span>

                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_x</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;pt_1a_x&#39;</span><span class="p">])</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_x</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;pt_1b_x&#39;</span><span class="p">])</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_y</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;pt_1a_y&#39;</span><span class="p">])</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_y</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;pt_1b_y&#39;</span><span class="p">])</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1_x_pts</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;pt_1_x&#39;</span><span class="p">])</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1_y_pts</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;pt_1_y&#39;</span><span class="p">])</span>

        <span class="k">def</span> <span class="nf">stop_script</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">script_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;STOP&#39;</span><span class="p">)</span>


    <span class="c1">##################################################################################</span>
    <span class="c1"># ADD GLOBAL ####################################################################</span>
    <span class="c1">##################################################################################</span>
    <span class="k">def</span> <span class="nf">add_global</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">row_start</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column_start</span> <span class="o">=</span>  <span class="mi">1</span><span class="p">):</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_load_settings</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;load settings&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_load_settings</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">load_settings</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_load_settings</span><span class="p">,</span><span class="n">row_start</span><span class="p">,</span><span class="n">column_start</span><span class="p">)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_save_settings</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;save settings&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_save_settings</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">save_settings</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_save_settings</span><span class="p">,</span><span class="n">row_start</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_exit</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_exit</span><span class="p">,</span><span class="n">row_start</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># settings</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_APD</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_APD</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="s1">&#39;Use APD&#39;</span><span class="p">,</span> <span class="s1">&#39;Use Diode&#39;</span><span class="p">])</span>
        <span class="c1"># ApplicationWindow.cmb_APD.changeEvent(ApplicationWindow.button_APD)</span>
        <span class="c1"># ApplicationWindow.button_APD = QtGui.QPushButton(&#39;Use APD&#39;,ApplicationWindow.main_widget)</span>
        <span class="c1"># ApplicationWindow.button_APD.setCheckable(True)</span>
        <span class="c1"># ApplicationWindow.button_APD.setChecked(True)</span>
        <span class="c1"># ApplicationWindow.button_APD.clicked.connect(ApplicationWindow.button_APD)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_APD</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">choose_setup</span><span class="p">(</span><span class="n">setup</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">setup</span> <span class="o">==</span> <span class="s1">&#39;Warm Setup&#39;</span><span class="p">:</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">piezo</span> <span class="o">=</span> <span class="s1">&#39;Z&#39;</span>
            <span class="k">elif</span> <span class="n">setup</span> <span class="o">==</span> <span class="s1">&#39;Cold Setup&#39;</span><span class="p">:</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">piezo</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span>

        <span class="k">def</span> <span class="nf">set_img_FW</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;not yet implemented&quot;</span><span class="p">)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_img</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_img</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="s1">&#39;Fluorescence&#39;</span><span class="p">,</span> <span class="s1">&#39;Reflection&#39;</span><span class="p">])</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_img</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_img</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">set_img_FW</span><span class="p">)</span>


        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_setup</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_setup</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="s1">&#39;Warm Setup&#39;</span><span class="p">,</span> <span class="s1">&#39;Cold Setup&#39;</span><span class="p">])</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_setup</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">choose_setup</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_setup</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span>


    <span class="c1">##################################################################################</span>
    <span class="c1"># ADD SETTINGS ####################################################################</span>
    <span class="c1">##################################################################################</span>
    <span class="k">def</span> <span class="nf">add_settings</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">row_start</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column_start</span> <span class="o">=</span>  <span class="mi">1</span><span class="p">):</span>


        <span class="n">click_id</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">def</span> <span class="nf">get_image_point</span><span class="p">(</span><span class="n">pt_id</span><span class="p">):</span>

            <span class="k">def</span> <span class="nf">clicked_image</span><span class="p">(</span><span class="n">eclick</span><span class="p">):</span>

                <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;{:0.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eclick</span><span class="o">.</span><span class="n">xdata</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;{:0.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eclick</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pt_id</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span>
                    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2a_x</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2a_y</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">pt_id</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
                    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2b_x</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2b_y</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">pt_id</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
                    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2c_x</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2c_y</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>



                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="n">click_id</span><span class="p">)</span>
                <span class="n">reset_shapes</span><span class="p">()</span>


            <span class="n">click_id</span> <span class="o">=</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="n">clicked_image</span><span class="p">)</span>


        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_scan_1a</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;pt 1a (scan)&quot;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_scan_1a</span><span class="p">,</span><span class="n">row_start</span><span class="p">,</span><span class="n">column_start</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_scan_1b</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;pt 1b (scan)&quot;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_scan_1b</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">column_start</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_pts_1</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;# pts 1&quot;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_pts_1</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">column_start</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_scan_2a</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;pt 2a&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_scan_2a</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">get_image_point</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_scan_2a</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="n">column_start</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_scan_2b</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;pt 2b&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_scan_2b</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">get_image_point</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">))</span>
        <span class="c1"># ApplicationWindow.button_scan_2b.clicked.connect(lambda: ApplicationWindow.imPlot.mpl_connect(&#39;button_press_event&#39;, lambda x: get_image_point(x, &#39;b&#39;)))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_scan_2b</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span><span class="n">column_start</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_scan_2c</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;pt 2c&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_scan_2c</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">get_image_point</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">))</span>
        <span class="c1"># ApplicationWindow.button_scan_2b.clicked.connect(lambda: ApplicationWindow.imPlot.mpl_connect(&#39;button_press_event&#39;, lambda x: get_image_point(x, &#39;b&#39;)))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_scan_2c</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">column_start</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_pts_2</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;# pts 2&quot;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_pts_2</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">6</span><span class="p">,</span><span class="n">column_start</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_laser</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;laser&quot;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_laser</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">7</span><span class="p">,</span><span class="n">column_start</span><span class="p">)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_x</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_x</span><span class="p">,</span><span class="n">row_start</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_x</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_x</span><span class="p">,</span><span class="n">row_start</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_x</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_x</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1_x_pts</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1_x_pts</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2a_x</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2a_x</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2b_x</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2b_x</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2c_x</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2c_x</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2_x_pts</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2_x_pts</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">6</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_laser_x</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_laser_x</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">7</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_y</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_y</span><span class="p">,</span><span class="n">row_start</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_y</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_y</span><span class="p">,</span><span class="n">row_start</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_y</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_y</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1_y_pts</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1_y_pts</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2a_y</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2a_y</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2b_y</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2b_y</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2c_y</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2c_y</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2_y_pts</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2_y_pts</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">6</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_laser_y</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_laser_y</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">7</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_set_laser</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;set laser&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_set_laser</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="p">:</span> <span class="n">set_laser</span><span class="p">(</span><span class="bp">None</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_set_laser</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>


        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_time_per_pt</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;time per pt&quot;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_time_per_pt</span><span class="p">,</span><span class="n">row_start</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_time_per_pt</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_time_per_pt</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_focus_voltage</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Focus Piezo Voltage&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_focus_voltage</span><span class="p">,</span> <span class="n">row_start</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">column_start</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_focus_voltage</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_focus_voltage</span><span class="p">,</span> <span class="n">row_start</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">column_start</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_set_voltage</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Set Piezo Voltage&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_set_voltage</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">piezo</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_focus_voltage</span><span class="o">.</span><span class="n">text</span><span class="p">())))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_set_voltage</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">6</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_angled_grid</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;Angled Grid&quot;</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_angled_grid</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reset_shapes</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_angled_grid</span><span class="p">,</span> <span class="n">row_start</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">column_start</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_copy_scan_params</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Copy Scan Parameters&quot;</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_copy_scan_params</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">copy_scan_params</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_copy_scan_params</span><span class="p">,</span> <span class="n">row_start</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">column_start</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># ApplicationWindow.RS = RectangleSelector(ApplicationWindow.imPlot.axes, ApplicationWindow.select_RoI, button = 3, drawtype=&#39;box&#39;, rectprops = rectprops)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_launch_attopanel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Attopanel&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_launch_attopanel</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="p">:</span> <span class="n">launch_attopanel</span><span class="p">())</span>

        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_launch_attopanel</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">7</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">daisy_handle</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">def</span> <span class="nf">launch_attopanel</span><span class="p">():</span>
            <span class="c1"># poll returns None if still running or 0 if stopped. this prevents multiple daisy applications from opening</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">daisy_handle</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">daisy_handle</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">daisy_handle</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s1">&#39;C:/Users/Experiment/Downloads/Software_ANC350v2/ANC350_GUI/daisy.exe&#39;</span><span class="p">)</span>

        <span class="c1"># def launch_attopanel():</span>
        <span class="c1">#     ApplicationWindow.attopanel = AttoPanel(ApplicationWindow)</span>
        <span class="c1">#     ApplicationWindow.attopanel.show()</span>
        <span class="c1">#</span>
        <span class="c1"># class AttoPanel(QtGui.QDialog):</span>
        <span class="c1">#     def __init__(self, parent):</span>
        <span class="c1">#         QtGui.QDialog.__init__(self,parent)</span>
        <span class="c1">#         self.setWindowTitle(&#39;Attocube Controller&#39;)</span>
        <span class="c1">#         self.Grid = QtGui.QGridLayout(self)</span>
        <span class="c1">#</span>
        <span class="c1">#         self.button_up = QtGui.QPushButton(&#39;up&#39;)</span>
        <span class="c1">#         self.button_up.clicked.connect(lambda: self.step_up())</span>
        <span class="c1">#         self.Grid.addWidget(self.button_up, 1, 1)</span>
        <span class="c1">#</span>
        <span class="c1">#         self.button_down = QtGui.QPushButton(&#39;down&#39;)</span>
        <span class="c1">#         self.button_down.clicked.connect(lambda: self.step_down())</span>
        <span class="c1">#         self.Grid.addWidget(self.button_down, 3, 1)</span>
        <span class="c1">#</span>
        <span class="c1">#         self.button_left = QtGui.QPushButton(&#39;left&#39;)</span>
        <span class="c1">#         self.button_left.clicked.connect(lambda: self.step_left())</span>
        <span class="c1">#         self.Grid.addWidget(self.button_left, 2, 0)</span>
        <span class="c1">#</span>
        <span class="c1">#         self.button_right = QtGui.QPushButton(&#39;right&#39;)</span>
        <span class="c1">#         self.button_right.clicked.connect(lambda: self.step_right())</span>
        <span class="c1">#         self.Grid.addWidget(self.button_right, 2, 2)</span>
        <span class="c1">#</span>
        <span class="c1">#         self.button_raise = QtGui.QPushButton(&#39;raise&#39;)</span>
        <span class="c1">#         self.button_raise.clicked.connect(lambda: self.step_raise())</span>
        <span class="c1">#         self.Grid.addWidget(self.button_raise, 1, 4)</span>
        <span class="c1">#</span>
        <span class="c1">#         self.button_lower = QtGui.QPushButton(&#39;lower&#39;)</span>
        <span class="c1">#         self.button_lower.clicked.connect(lambda: self.step_lower())</span>
        <span class="c1">#         self.Grid.addWidget(self.button_lower, 3, 4)</span>
        <span class="c1">#</span>
        <span class="c1">#         self.label_num_steps = QtGui.QLabel(&#39;Number of Steps&#39;)</span>
        <span class="c1">#         self.Grid.addWidget(self.label_num_steps, 0, 0)</span>
        <span class="c1">#</span>
        <span class="c1">#         def num_steps_assign(num_steps):</span>
        <span class="c1">#             self.num_steps = int(num_steps)</span>
        <span class="c1">#             print(self.num_steps)</span>
        <span class="c1">#</span>
        <span class="c1">#         self.txt_num_steps = QtGui.QLineEdit()</span>
        <span class="c1">#         self.txt_num_steps.textChanged.connect(lambda x: num_steps_assign(x))</span>
        <span class="c1">#         self.txt_num_steps.setText(&#39;1&#39;)</span>
        <span class="c1">#         self.Grid.addWidget(self.txt_num_steps, 0, 1)</span>
        <span class="c1">#</span>
        <span class="c1">#         self.cmb_axis = QtGui.QComboBox()</span>
        <span class="c1">#         self.cmb_axis.addItems([&#39;Z axis&#39;, &#39;X axis&#39;, &#39;Y axis&#39;])</span>
        <span class="c1">#         self.Grid.addWidget(self.cmb_axis, 2, 5)</span>
        <span class="c1">#</span>
        <span class="c1">#         self.cmb_operation = QtGui.QComboBox()</span>
        <span class="c1">#         self.cmb_operation.addItems([&#39;Amplitude&#39;, &#39;Frequency&#39;, &#39;Capacitance&#39;])</span>
        <span class="c1">#         self.Grid.addWidget(self.cmb_operation, 0, 5)</span>
        <span class="c1">#</span>
        <span class="c1">#         self.txt_atto = QtGui.QLineEdit()</span>
        <span class="c1">#         self.Grid.addWidget(self.txt_atto, 1, 5)</span>
        <span class="c1">#</span>
        <span class="c1">#         self.button_atto_get = QtGui.QPushButton(&#39;Get&#39;)</span>
        <span class="c1">#         self.button_atto_get.clicked.connect(lambda: self.atto_operation_get())</span>
        <span class="c1">#         self.Grid.addWidget(self.button_atto_get, 3, 5)</span>
        <span class="c1">#</span>
        <span class="c1">#         self.button_atto_set = QtGui.QPushButton(&#39;Set&#39;)</span>
        <span class="c1">#         self.button_atto_set.clicked.connect(lambda: self.atto_operation_set())</span>
        <span class="c1">#         self.Grid.addWidget(self.button_atto_set, 4, 5)</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1">#         self.Grid.setColumnMinimumWidth(3, 75)</span>
        <span class="c1">#</span>
        <span class="c1">#         self.controller = AC.ANC350()</span>
        <span class="c1">#</span>
        <span class="c1">#     def step_up(self):</span>
        <span class="c1">#         for i in range(self.num_steps):</span>
        <span class="c1">#             self.controller.step_piezo(1,0)</span>
        <span class="c1">#</span>
        <span class="c1">#     def step_down(self):</span>
        <span class="c1">#         for i in range(self.num_steps):</span>
        <span class="c1">#             self.controller.step_piezo(1,1)</span>
        <span class="c1">#</span>
        <span class="c1">#     def step_left(self):</span>
        <span class="c1">#         for i in range(self.num_steps):</span>
        <span class="c1">#             self.controller.step_piezo(2,0)</span>
        <span class="c1">#</span>
        <span class="c1">#     def step_right(self):</span>
        <span class="c1">#         for i in range(self.num_steps):</span>
        <span class="c1">#             self.controller.step_piezo(2,1)</span>
        <span class="c1">#</span>
        <span class="c1">#     def step_raise(self):</span>
        <span class="c1">#         for i in range(self.num_steps):</span>
        <span class="c1">#             self.controller.step_piezo(0,0)</span>
        <span class="c1">#</span>
        <span class="c1">#     def step_lower(self):</span>
        <span class="c1">#         for i in range(self.num_steps):</span>
        <span class="c1">#             self.controller.step_piezo(0,1)</span>
        <span class="c1">#</span>
        <span class="c1">#     def atto_operation_get(self):</span>
        <span class="c1">#         if self.cmb_axis.currentText() == &#39;Z axis&#39;:</span>
        <span class="c1">#             axis = 0</span>
        <span class="c1">#         elif self.cmb_axis.currentText() == &#39;X axis&#39;:</span>
        <span class="c1">#             axis = 1</span>
        <span class="c1">#         elif self.cmb_axis.currentText() == &#39;Y axis&#39;:</span>
        <span class="c1">#             axis = 2</span>
        <span class="c1">#</span>
        <span class="c1">#         if self.cmb_operation.currentText() == &#39;Amplitude&#39;:</span>
        <span class="c1">#             self.txt_atto.setText(str(self.controller.get_amplitude(axis)))</span>
        <span class="c1">#         elif self.cmb_operation.currentText() == &#39;Frequency&#39;:</span>
        <span class="c1">#             self.txt_atto.setText(str(self.controller.get_frequency(axis)))</span>
        <span class="c1">#         elif self.cmb_operation.currentText() == &#39;Capacitance&#39;:</span>
        <span class="c1">#             self.txt_atto.setText(str(self.controller.cap_measure(axis)))</span>
        <span class="c1">#</span>
        <span class="c1">#     def atto_operation_set(self):</span>
        <span class="c1">#         if self.cmb_axis.currentText() == &#39;Z axis&#39;:</span>
        <span class="c1">#             axis = 0</span>
        <span class="c1">#         elif self.cmb_axis.currentText() == &#39;X axis&#39;:</span>
        <span class="c1">#             axis = 1</span>
        <span class="c1">#         elif self.cmb_axis.currentText() == &#39;Y axis&#39;:</span>
        <span class="c1">#             axis = 2</span>
        <span class="c1">#</span>
        <span class="c1">#         if self.cmb_operation.currentText() == &#39;Amplitude&#39;:</span>
        <span class="c1">#             self.controller.set_amplitude(axis, float(self.txt_atto.text()))</span>
        <span class="c1">#         elif self.cmb_operation.currentText() == &#39;Frequency&#39;:</span>
        <span class="c1">#             self.controller.get_frequency(axis, float(self.txt_atto.text()))</span>
        <span class="c1">#         elif self.cmb_operation.currentText() == &#39;Capacitance&#39;:</span>
        <span class="c1">#             self.txt_atto.setText(&#39;ERROR CANNOT SET CAPACITANCE&#39;)</span>


    <span class="c1">##################################################################################</span>
    <span class="c1"># ADD DISPLAY ####################################################################</span>
    <span class="c1">##################################################################################</span>
    <span class="k">def</span> <span class="nf">add_display</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">row_start</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column_start</span> <span class="o">=</span>  <span class="mi">1</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">execute_scan</span><span class="p">():</span>

            <span class="n">remove_patches</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>

            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s2">&quot;Taking Image&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">zoomed_in</span><span class="p">:</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_x</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2a_x</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_x</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2b_x</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_y</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2a_y</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_y</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2b_y</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">zoomed_in</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="n">pta_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_x</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">ptb_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_x</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">pta_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_y</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">ptb_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_y</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="n">xMin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">pta_x</span><span class="p">,</span> <span class="n">ptb_x</span><span class="p">])</span>
            <span class="n">xMax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">pta_x</span><span class="p">,</span> <span class="n">ptb_x</span><span class="p">])</span>
            <span class="n">yMin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">pta_y</span><span class="p">,</span> <span class="n">ptb_y</span><span class="p">])</span>
            <span class="n">yMax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">pta_y</span><span class="p">,</span> <span class="n">ptb_y</span><span class="p">])</span>

            <span class="n">pts_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1_x_pts</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">pts_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1_y_pts</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="n">timePerPt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_time_per_pt</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="n">bool_use_apd</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_APD</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span> <span class="o">==</span> <span class="s1">&#39;Use APD&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_distconv</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">dist_volt_conv</span> <span class="o">=</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_distconv</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dist_volt_conv</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imageData</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imageRoI</span> <span class="o">=</span> <span class="n">DeviceTriggers</span><span class="o">.</span><span class="n">scanGui</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="p">,</span><span class="n">xMin</span><span class="p">,</span><span class="n">xMax</span><span class="p">,</span><span class="n">pts_x</span><span class="p">,</span><span class="n">yMin</span><span class="p">,</span><span class="n">yMax</span><span class="p">,</span><span class="n">pts_y</span><span class="p">,</span><span class="n">timePerPt</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">scan_queue</span><span class="p">,</span> <span class="n">bool_use_apd</span><span class="p">,</span> <span class="n">dist_volt_conv</span><span class="p">)</span>

            <span class="n">set_laser</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">clearMessage</span><span class="p">()</span>
            <span class="n">reset_shapes</span><span class="p">()</span>
            <span class="c1"># if(ApplicationWindow.autosaveCheck.isChecked() == True):</span>
            <span class="c1">#     ApplicationWindow.saveImageClicked()</span>
        <span class="k">def</span> <span class="nf">interrupt_scan</span><span class="p">():</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">scan_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;STOP&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">zoom_RoI_in</span><span class="p">():</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">pt_a</span><span class="p">,</span> <span class="n">pt_b</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
            <span class="n">xmin</span>  <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pt_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt_b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">xmax</span>  <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pt_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt_b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ymin</span>  <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pt_a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt_b</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ymax</span>  <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pt_a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt_b</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span><span class="n">xmax</span><span class="p">)</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span> <span class="n">ymax</span><span class="p">)</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">zoomed_in</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">def</span> <span class="nf">zoom_RoI_out</span><span class="p">():</span>
            <span class="n">pt_a</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_x</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_y</span><span class="o">.</span><span class="n">text</span><span class="p">())]</span>
            <span class="n">pt_b</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_x</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_y</span><span class="o">.</span><span class="n">text</span><span class="p">())]</span>

            <span class="n">xmin</span>  <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pt_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt_b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">xmax</span>  <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pt_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt_b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ymin</span>  <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pt_a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt_b</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ymax</span>  <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pt_a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pt_b</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span><span class="n">xmax</span><span class="p">)</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span> <span class="n">ymax</span><span class="p">)</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">zoomed_in</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">patches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">nv_points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">selected_points</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_roi</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;&amp;region of interest (RoI)&quot;</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_roi</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reset_shapes</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_roi</span><span class="p">,</span><span class="n">row_start</span><span class="p">,</span> <span class="n">column_start</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_NVs</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;selected NVs&quot;</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_NVs</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reset_shapes</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_NVs</span><span class="p">,</span><span class="n">row_start</span><span class="p">,</span> <span class="n">column_start</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_NV_labels</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;NV labels&quot;</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_NV_labels</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reset_shapes</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_NV_labels</span><span class="p">,</span><span class="n">row_start</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">column_start</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_grid</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;Grid&quot;</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_grid</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reset_shapes</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_grid</span><span class="p">,</span><span class="n">row_start</span> <span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">column_start</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_line</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;Line&quot;</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_line</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reset_shapes</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_line</span><span class="p">,</span><span class="n">row_start</span> <span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">column_start</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_pt2</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;pt 2a&quot;</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_pt2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reset_shapes</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_pt2</span><span class="p">,</span><span class="n">row_start</span> <span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="n">column_start</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_laser</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;Laser&quot;</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_laser</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reset_shapes</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_laser</span><span class="p">,</span><span class="n">row_start</span> <span class="o">+</span><span class="mi">5</span><span class="p">,</span> <span class="n">column_start</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_distconv</span><span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;Convert to Distance&quot;</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_distconv</span><span class="p">,</span><span class="n">row_start</span> <span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="n">column_start</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_distconv</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">()</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_distconv</span><span class="p">,</span><span class="n">row_start</span> <span class="o">+</span><span class="mi">5</span><span class="p">,</span> <span class="n">column_start</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># set RoI and zoom</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_zoom_in_RoI</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;zoom in (RoI)&#39;</span><span class="p">,</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_zoom_in_RoI</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">zoom_RoI_in</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_zoom_in_RoI</span><span class="p">,</span><span class="n">row_start</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_zoom_out_RoI</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;zoom out&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_zoom_out_RoI</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">zoom_RoI_out</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_zoom_out_RoI</span><span class="p">,</span><span class="n">row_start</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># color bar</span>
        <span class="k">def</span> <span class="nf">cbarThreshClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">remove_patches</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
            <span class="n">xMin</span><span class="p">,</span> <span class="n">xMax</span><span class="p">,</span> <span class="n">yMin</span><span class="p">,</span> <span class="n">yMax</span> <span class="o">=</span> <span class="n">get_min_max</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
            <span class="n">DeviceTriggers</span><span class="o">.</span><span class="n">updateColorbar</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imageData</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="p">,</span> <span class="p">[</span><span class="n">xMin</span><span class="p">,</span> <span class="n">xMax</span><span class="p">,</span> <span class="n">yMin</span><span class="p">,</span> <span class="n">yMax</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cbar_max</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
            <span class="n">display_shapes</span><span class="p">()</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cbar_max</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cbar_max</span><span class="p">,</span><span class="n">row_start</span> <span class="o">+</span><span class="mi">6</span><span class="p">,</span> <span class="n">column_start</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_cbar_max</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Colorbar Threshold&quot;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">label_cbar_max</span><span class="p">,</span><span class="n">row_start</span> <span class="o">+</span><span class="mi">6</span><span class="p">,</span> <span class="n">column_start</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_cbar_thresh</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Update Colorbar&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_cbar_thresh</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">cbarThreshClicked</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_cbar_thresh</span><span class="p">,</span><span class="n">row_start</span> <span class="o">+</span><span class="mi">6</span><span class="p">,</span> <span class="n">column_start</span> <span class="o">+</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_stop</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Stop Scan&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_stop</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">interrupt_scan</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_stop</span><span class="p">,</span><span class="n">row_start</span> <span class="o">+</span><span class="mi">7</span><span class="p">,</span><span class="n">column_start</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_scan</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Scan&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_scan</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">execute_scan</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_scan</span><span class="p">,</span><span class="n">row_start</span> <span class="o">+</span><span class="mi">7</span><span class="p">,</span><span class="n">column_start</span><span class="p">)</span>

        <span class="c1"># save image</span>
        <span class="k">def</span> <span class="nf">write_image</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">columns</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">header</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">header</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H-%M-%S&quot;</span><span class="p">)</span>
            <span class="n">filepathCSV</span> <span class="o">=</span> <span class="n">dirpath</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">start_time</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>
            <span class="n">filepathJPG</span> <span class="o">=</span> <span class="n">dirpath</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">start_time</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span>
            <span class="c1"># filepathCSV = dirpath + filename + &#39;.csv&#39;</span>
            <span class="c1"># filepathJPG = dirpath + filename + &#39;.jpg&#39;</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filepathCSV</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filepathJPG</span><span class="p">),</span> <span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;jpg&#39;</span><span class="p">)</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s2">&quot;Image Data Saved&quot;</span><span class="p">,</span><span class="mi">2000</span><span class="p">)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_save_image_location</span> <span class="o">=</span> <span class="n">gui_cw</span><span class="o">.</span><span class="n">FileBoxSave</span><span class="p">(</span><span class="s1">&#39;Z://Lab//Cantilever//Measurements//&#39;</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_save_image_location</span><span class="p">,</span> <span class="n">row_start</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="n">column_start</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_save_image_tag</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_save_image_tag</span><span class="p">,</span> <span class="n">row_start</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="n">column_start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_save_image</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Save Image&#39;</span><span class="p">,</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_save_image</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">write_image</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imageData</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_save_image_location</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_save_image_tag</span><span class="o">.</span><span class="n">text</span><span class="p">())))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_save_image</span><span class="p">,</span> <span class="n">row_start</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="n">column_start</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>




        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">scan_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">script_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">add_choosing_points</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">row_start</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column_start</span> <span class="o">=</span>  <span class="mi">1</span><span class="p">):</span>

        <span class="c1"># def run_esr(ApplicationWindow):</span>
        <span class="c1">#     nv_locs = numpy.array(pd.read_csv(str(ApplicationWindow.esrReadLoc.text()) + &#39;.csv&#39;, header = None))</span>
        <span class="c1">#     print(nv_locs)</span>
        <span class="c1">#     print(len(nv_locs))</span>
        <span class="c1">#     img_baseline = numpy.array(pd.read_csv(str(ApplicationWindow.esrReadLoc.text()) + &#39;baselineimg.csv&#39;))</span>
        <span class="c1">#     ApplicationWindow.loadRoI(str(ApplicationWindow.esrReadLoc.text()) + &#39;.roi&#39;)</span>
        <span class="c1">#     esr_num = 0</span>
        <span class="c1">#     RF_Power = -12</span>
        <span class="c1">#     avg = 100</span>
        <span class="c1">#     while esr_num &lt; len(nv_locs):</span>
        <span class="c1">#         print(esr_num)</span>
        <span class="c1">#</span>
        <span class="c1">#         ApplicationWindow.statusBar().showMessage(&quot;Focusing&quot;, 0)</span>
        <span class="c1">#         zo = float(ApplicationWindow.zPos.text())</span>
        <span class="c1">#         dz = float(ApplicationWindow.zRange.text())</span>
        <span class="c1">#         zPts = float(ApplicationWindow.zPts.text())</span>
        <span class="c1">#         xyPts = float(ApplicationWindow.xyRange.text())</span>
        <span class="c1">#         zMin, zMax = zo - dz/2., zo + dz/2.</span>
        <span class="c1">#         roi_focus = ApplicationWindow.RoI.copy()</span>
        <span class="c1">#         roi_focus[&#39;dx&#39;] = .005</span>
        <span class="c1">#         roi_focus[&#39;dy&#39;] = .005</span>
        <span class="c1">#         roi_focus[&#39;xo&#39;] = nv_locs[0][0]</span>
        <span class="c1">#         roi_focus[&#39;yo&#39;] = nv_locs[0][1]</span>
        <span class="c1">#         roi_focus[&#39;xPts&#39;] = xyPts</span>
        <span class="c1">#         roi_focus[&#39;yPts&#39;] = xyPts</span>
        <span class="c1">#         print roi_focus</span>
        <span class="c1">#         voltage_focus = focusing.Focus.scan(zMin, zMax, zPts, &#39;Z&#39;, waitTime = .1, APD=True, scan_range_roi = roi_focus)</span>
        <span class="c1">#         ApplicationWindow.zPos.setText(&#39;{:0.4f}&#39;.format(voltage_focus))</span>
        <span class="c1">#         ApplicationWindow.statusBar().clearMessage()</span>
        <span class="c1">#         plt.close()</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1">#         ApplicationWindow.statusBar().showMessage(&quot;Scanning and Correcting for Shift&quot;, 0)</span>
        <span class="c1">#         xmin, xmax, ymin, ymax = roi_to_min_max(ApplicationWindow.RoI)</span>
        <span class="c1">#         img_new, ApplicationWindow.imageRoI = DeviceTriggers.scanGui(ApplicationWindow.imPlot, xmin, xmax, ApplicationWindow.RoI[&#39;xPts&#39;], ymin, ymax, ApplicationWindow.RoI[&#39;xPts&#39;], .001)</span>
        <span class="c1">#         shift = track.corr_NVs(img_baseline, img_new)</span>
        <span class="c1">#         print(shift)</span>
        <span class="c1">#         ApplicationWindow.RoI = track.update_roi(ApplicationWindow.RoI, shift)</span>
        <span class="c1">#         nv_locs = track.shift_points_v(nv_locs, ApplicationWindow.RoI, shift)</span>
        <span class="c1">#         xmin, xmax, ymin, ymax = roi_to_min_max(ApplicationWindow.RoI)</span>
        <span class="c1">#         ApplicationWindow.imPlot.axes.set_xlim(left= xmin, right =xmax)</span>
        <span class="c1">#         ApplicationWindow.imPlot.axes.set_ylim(top=ymin,bottom= ymax)</span>
        <span class="c1">#         img_new, ApplicationWindow.imageRoI = DeviceTriggers.scanGui(ApplicationWindow.imPlot, xmin, xmax, ApplicationWindow.RoI[&#39;xPts&#39;], ymin, ymax, ApplicationWindow.RoI[&#39;xPts&#39;], .001)</span>
        <span class="c1">#         ApplicationWindow.statusBar().clearMessage()</span>
        <span class="c1">#         for pt in nv_locs:</span>
        <span class="c1">#             circ = patches.Circle((pt[0], pt[1]), .01*min(ApplicationWindow.RoI[&#39;dx&#39;],ApplicationWindow.RoI[&#39;dy&#39;]), fc = &#39;b&#39;)</span>
        <span class="c1">#             ApplicationWindow.imPlot.axes.add_patch(circ)</span>
        <span class="c1">#</span>
        <span class="c1">#         nv_locs = track.locate_shifted_NVs(img_new, nv_locs, ApplicationWindow.RoI)</span>
        <span class="c1">#         for pt in nv_locs:</span>
        <span class="c1">#             circ = patches.Circle((pt[0], pt[1]), .01*min(ApplicationWindow.RoI[&#39;dx&#39;],ApplicationWindow.RoI[&#39;dy&#39;]), fc = &#39;r&#39;)</span>
        <span class="c1">#             ApplicationWindow.imPlot.axes.add_patch(circ)</span>
        <span class="c1">#         ApplicationWindow.imPlot.draw()</span>
        <span class="c1">#         pt = nv_locs[esr_num]</span>
        <span class="c1">#</span>
        <span class="c1">#         if(pt[0] == 0 and pt[1] == 0): # failed to find matching NV in shifted frame</span>
        <span class="c1">#             esr_num += 1</span>
        <span class="c1">#             continue</span>
        <span class="c1">#         ApplicationWindow.statusBar().showMessage(&quot;Running ESR&quot;, 0)</span>
        <span class="c1">#         test_freqs = numpy.linspace(2820000000, 2920000000, 200)</span>
        <span class="c1">#         esr_data, fit_params, fig = ESR.run_esr(RF_Power, test_freqs, pt, num_avg=avg, int_time=.002)</span>
        <span class="c1">#         dirpath = &#39;Z:\\Lab\\Cantilever\\Measurements\\20150712_GuiTest&#39;</span>
        <span class="c1">#         tag = &#39;NV{:00d}_RFPower_{:03d}mdB_NumAvrg_{:03d}&#39;.format(esr_num, RF_Power, avg)</span>
        <span class="c1">#         ESR.save_esr(esr_data, fig, dirpath, tag)</span>
        <span class="c1">#         esr_num += 1</span>
        <span class="c1">#         ApplicationWindow.statusBar().clearMessage()</span>
        <span class="c1">#</span>
        <span class="c1">#     ApplicationWindow.circ = None</span>
        <span class="c1">#     ApplicationWindow.rect = None</span>


        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">is_choosing_points</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c1"># select NVs</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_select_NVs</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;select NV&#39;</span><span class="p">,</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_select_NVs</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_select_NVs</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_select_NVs</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">choosing_points</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">button_select_NVs</span><span class="p">,</span><span class="n">row_start</span><span class="p">,</span><span class="n">column_start</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">add_test</span><span class="p">(</span><span class="n">grid</span><span class="p">):</span>
        <span class="n">txt_boxes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;text1&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;text2&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">txt_boxes</span><span class="p">):</span>
            <span class="n">txt_boxes</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">x</span><span class="p">:</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">)})</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">txt_boxes</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="mi">5</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="c1"># for name in txt_names:</span>
        <span class="c1">#     ApplicationWindow.txt_boxes.update{&#39;&#39;} = QtGui.QLineEdit(ApplicationWindow.main_widget)</span>
        <span class="c1">#     grid.addWidget(ApplicationWindow.txt_test, 5, 5)</span>
    <span class="c1">##################################################################################</span>
    <span class="c1">##### GRID IMAGE #################################################################</span>
    <span class="c1">##################################################################################</span>
    <span class="c1"># ApplicationWindow.grid_image = QtGui.QGridLayout()</span>
    <span class="c1"># vbox_main.addLayout(ApplicationWindow.grid_image)</span>

    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span> <span class="o">=</span> <span class="n">gui_cw</span><span class="o">.</span><span class="n">MyMplCanvas</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">plotBox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="p">)</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">focPlot</span> <span class="o">=</span> <span class="n">gui_cw</span><span class="o">.</span><span class="n">MyMplCanvas</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">plotBox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">focPlot</span><span class="p">)</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">esrPlot</span> <span class="o">=</span> <span class="n">gui_cw</span><span class="o">.</span><span class="n">MyMplCanvas</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">main_widget</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">plotBox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">esrPlot</span><span class="p">)</span>

    <span class="c1">#ApplicationWindow.imageData = None</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imageData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">Experiment</span><span class="se">\\</span><span class="s1">Desktop</span><span class="se">\\</span><span class="s1">GuiIcons</span><span class="se">\\</span><span class="s1">beaker.jpg&#39;</span><span class="p">))</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imageData</span><span class="p">)</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="c1"># ApplicationWindow.mouseNVImageConnect = ApplicationWindow.imPlot.mpl_connect(&#39;button_press_event&#39;, ApplicationWindow.mouseNVImage)</span>
    <span class="c1"># rectprops = dict(facecolor = &#39;black&#39;, edgecolor = &#39;black&#39;, alpha = 1.0, fill = True)</span>
    <span class="c1"># ApplicationWindow.RS = RectangleSelector(ApplicationWindow.imPlot.axes, ApplicationWindow.select_RoI, button = 3, drawtype=&#39;box&#39;, rectprops = rectprops)</span>

    <span class="c1">##### GRID CONTROLS ############################################################################################</span>
    <span class="c1">################################################################################################################</span>

    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_controls</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>
    <span class="n">vbox_main</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_controls</span><span class="p">)</span>

    <span class="c1">##### settings #################################################################################################</span>


    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">group_settings</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGroupBox</span><span class="p">(</span><span class="s2">&quot;Settings&quot;</span><span class="p">)</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_settings</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_controls</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">group_settings</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">group_settings</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_settings</span><span class="p">)</span>

    <span class="n">add_settings</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_settings</span><span class="p">)</span>



    <span class="c1">##### display #################################################################################################</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">group_display</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGroupBox</span><span class="p">(</span><span class="s2">&quot;Display&quot;</span><span class="p">)</span>
    <span class="c1"># ApplicationWindow.group_display.isCheckable()</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_display</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_controls</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">group_display</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">group_display</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_display</span><span class="p">)</span>

    <span class="n">add_display</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_display</span><span class="p">)</span>
    <span class="n">add_choosing_points</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_display</span><span class="p">,</span> <span class="n">row_start</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">column_start</span> <span class="o">=</span>  <span class="mi">3</span><span class="p">)</span>

    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">plot_nvs</span> <span class="o">=</span> <span class="bp">False</span>


    <span class="c1">##### execute #################################################################################################</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">group_execute</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGroupBox</span><span class="p">(</span><span class="s2">&quot;Execute&quot;</span><span class="p">)</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_execute</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_controls</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">group_execute</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">group_execute</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_execute</span><span class="p">)</span>

    <span class="n">add_execute</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_execute</span><span class="p">)</span>
    <span class="c1"># add_test(ApplicationWindow.grid_execute)</span>

    <span class="c1">##### global #################################################################################################</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">group_global</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGroupBox</span><span class="p">(</span><span class="s2">&quot;global&quot;</span><span class="p">)</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_global</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_controls</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">group_global</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">group_global</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_global</span><span class="p">)</span>

    <span class="n">add_global</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">grid_global</span><span class="p">)</span>


    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">zoomed_in</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">load_settings</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="s1">&#39;Z://Lab//Cantilever//Measurements//default.set&#39;</span><span class="p">)</span>

    <span class="n">reset_shapes</span><span class="p">()</span>
    <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="load_settings"><a class="viewcode-back" href="../../../src/src.gui.gui_scan_layout.html#src.gui.gui_scan_layout.load_settings">[docs]</a><span class="k">def</span> <span class="nf">load_settings</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">dict_to_values_settings</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_x</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;pt_1a_x&#39;</span><span class="p">])</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_x</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;pt_1b_x&#39;</span><span class="p">])</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2a_x</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;pt_2a_x&#39;</span><span class="p">])</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2b_x</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;pt_2b_x&#39;</span><span class="p">])</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2c_x</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;pt_2c_x&#39;</span><span class="p">])</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_y</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;pt_1a_y&#39;</span><span class="p">])</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_y</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;pt_1b_y&#39;</span><span class="p">])</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2a_y</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;pt_2a_y&#39;</span><span class="p">])</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2b_y</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;pt_2b_y&#39;</span><span class="p">])</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2c_y</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;pt_2c_y&#39;</span><span class="p">])</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1_x_pts</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;pt_1_x&#39;</span><span class="p">])</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1_y_pts</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;pt_1_y&#39;</span><span class="p">])</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2_x_pts</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;pt_2_x&#39;</span><span class="p">])</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2_y_pts</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;pt_2_y&#39;</span><span class="p">])</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_laser_x</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;pt_laser_x&#39;</span><span class="p">])</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_laser_y</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;pt_laser_y&#39;</span><span class="p">])</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_time_per_pt</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;txt_time_per_pt&#39;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">dict_to_values_display</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_roi</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;show_roi&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span> <span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_line</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;show_line&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_grid</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;show_grid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span><span class="p">)</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_laser</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;show_laser&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">dict_to_values_execute</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">parameters_paths_scripts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;parameters_paths_script&#39;</span><span class="p">]</span>
        <span class="k">print</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">parameters_paths_scripts</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_execute</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_execute</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;selected_script&#39;</span><span class="p">]))</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">path_script</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;parameters_paths_script&#39;</span><span class="p">][</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;selected_script&#39;</span><span class="p">]])</span>





    <span class="k">def</span> <span class="nf">dict_to_values_global</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_APD</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_APD</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;selected_detector&#39;</span><span class="p">]))</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_setup</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_setup</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;selected_setup&#39;</span><span class="p">]))</span>

        <span class="k">def</span> <span class="nf">choose_setup</span><span class="p">(</span><span class="n">setup</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">setup</span> <span class="o">==</span> <span class="s1">&#39;Warm Setup&#39;</span><span class="p">:</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">piezo</span> <span class="o">=</span> <span class="s1">&#39;Z&#39;</span>
            <span class="k">elif</span> <span class="n">setup</span> <span class="o">==</span> <span class="s1">&#39;Cold Setup&#39;</span><span class="p">:</span>
                <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">piezo</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span>

        <span class="n">choose_setup</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;selected_setup&#39;</span><span class="p">])</span>
        <span class="c1">#ApplicationWindow.txt_focus_voltage.setText(str(PC.MDT693A(&#39;Z&#39;).getVoltage()))</span>




    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="s1">&#39;Open file&#39;</span><span class="p">,</span> <span class="s1">&#39;Z://Lab//Cantilever//Measurements//&#39;</span><span class="p">,</span> <span class="s1">&#39;*.set&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">rw</span><span class="o">.</span><span class="n">load_json</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># print settings</span>
        <span class="n">dict_to_values_settings</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">])</span>
        <span class="n">dict_to_values_display</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;display&#39;</span><span class="p">])</span>
        <span class="n">dict_to_values_execute</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;execute&#39;</span><span class="p">])</span>
        <span class="n">dict_to_values_global</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">])</span>


        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s1">&#39;loaded {:s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="save_settings"><a class="viewcode-back" href="../../../src/src.gui.gui_scan_layout.html#src.gui.gui_scan_layout.save_settings">[docs]</a><span class="k">def</span> <span class="nf">save_settings</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="n">set_filename</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">     saves the setting</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">values_to_dict_settings</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>

        <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;pt_1a_x&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_x</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s2">&quot;pt_1b_x&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_x</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s2">&quot;pt_2a_x&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2a_x</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s2">&quot;pt_2b_x&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2b_x</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s2">&quot;pt_2c_x&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2c_x</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s2">&quot;pt_1a_y&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_y</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s2">&quot;pt_1b_y&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_y</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s2">&quot;pt_2a_y&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2a_y</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s2">&quot;pt_2b_y&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2b_y</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s2">&quot;pt_2c_y&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2c_y</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s2">&quot;pt_1_x&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1_x_pts</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s2">&quot;pt_1_y&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1_y_pts</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s2">&quot;pt_2_x&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2_x_pts</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s2">&quot;pt_2_y&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2_y_pts</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s2">&quot;pt_laser_x&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_laser_x</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s2">&quot;pt_laser_y&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_laser_y</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s2">&quot;txt_time_per_pt&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_time_per_pt</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nb">dict</span>
    <span class="k">def</span> <span class="nf">values_to_dict_display</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>

        <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;show_roi&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_roi</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()),</span>
            <span class="s2">&quot;show_line&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_line</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()),</span>
            <span class="s2">&quot;show_grid&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_grid</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()),</span>
            <span class="s2">&quot;show_laser&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">radio_laser</span><span class="o">.</span><span class="n">isChecked</span><span class="p">())</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nb">dict</span>
    <span class="k">def</span> <span class="nf">values_to_dict_execute</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>

        <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;selected_script&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_execute</span><span class="o">.</span><span class="n">currentText</span><span class="p">()),</span>
            <span class="c1"># &#39;path_script&#39;: str(ApplicationWindow.path_script.text()),</span>
            <span class="s1">&#39;parameters_paths_script&#39;</span><span class="p">:</span>  <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">parameters_paths_scripts</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nb">dict</span>
    <span class="k">def</span> <span class="nf">values_to_dict_global</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>

        <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;selected_detector&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_APD</span><span class="o">.</span><span class="n">currentText</span><span class="p">()),</span>
            <span class="s2">&quot;selected_setup&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">cmb_setup</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nb">dict</span>

    <span class="k">if</span> <span class="n">set_filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">set_filename</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="s1">&#39;select file&#39;</span><span class="p">,</span> <span class="s1">&#39;Z://Lab//Cantilever//Measurements//&#39;</span><span class="p">,</span> <span class="s1">&#39;*.set&#39;</span><span class="p">)</span>


    <span class="k">if</span> <span class="ow">not</span> <span class="n">set_filename</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">dict_settings</span> <span class="o">=</span> <span class="n">values_to_dict_settings</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
        <span class="n">dict_display</span> <span class="o">=</span> <span class="n">values_to_dict_display</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
        <span class="n">dict_execute</span> <span class="o">=</span> <span class="n">values_to_dict_execute</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>
        <span class="n">dict_global</span> <span class="o">=</span> <span class="n">values_to_dict_global</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">)</span>

        <span class="n">dict_all</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;settings&#39;</span><span class="p">:</span><span class="n">dict_settings</span><span class="p">,</span>
            <span class="s1">&#39;display&#39;</span><span class="p">:</span><span class="n">dict_display</span><span class="p">,</span>
            <span class="s1">&#39;execute&#39;</span><span class="p">:</span><span class="n">dict_execute</span><span class="p">,</span>
            <span class="s1">&#39;global&#39;</span><span class="p">:</span><span class="n">dict_global</span>
        <span class="p">}</span>

        <span class="n">rw</span><span class="o">.</span><span class="n">save_json</span><span class="p">(</span><span class="n">dict_all</span><span class="p">,</span> <span class="n">set_filename</span><span class="p">)</span>
        <span class="c1"># with open(set_filename, &#39;w&#39;) as outfile:</span>
        <span class="c1">#     tmp = json.dump(dict_all, outfile, indent=4)</span>

        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s1">&#39;saved {:s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">set_filename</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="save_settings_exp"><a class="viewcode-back" href="../../../src/src.gui.gui_scan_layout.html#src.gui.gui_scan_layout.save_settings_exp">[docs]</a><span class="k">def</span> <span class="nf">save_settings_exp</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
    <span class="n">day</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">month</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m&quot;</span><span class="p">)</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y&quot;</span><span class="p">)</span>
    <span class="n">hour</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H&quot;</span><span class="p">)</span>
    <span class="n">minute</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%M&quot;</span><span class="p">)</span>
    <span class="n">second</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%S&quot;</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">year</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">month</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">day</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">hour</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">minute</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">second</span>  <span class="o">+</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">dirpath</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.set&#39;</span>
    <span class="n">save_settings</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="n">set_filename</span><span class="o">=</span><span class="n">filepath</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_pts_and_size"><a class="viewcode-back" href="../../../src/src.gui.gui_scan_layout.html#src.gui.gui_scan_layout.get_pts_and_size">[docs]</a><span class="k">def</span> <span class="nf">get_pts_and_size</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="n">ptID</span> <span class="o">=</span> <span class="s1">&#39;2&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ptID</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
        <span class="n">pt_a</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_x</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_y</span><span class="o">.</span><span class="n">text</span><span class="p">())]</span>
        <span class="n">pt_b</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_x</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_y</span><span class="o">.</span><span class="n">text</span><span class="p">())]</span>
        <span class="n">pt_c</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1_x_pts</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1_y_pts</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">ptID</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span>
        <span class="n">pt_a</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2a_x</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2a_y</span><span class="o">.</span><span class="n">text</span><span class="p">())]</span>
        <span class="n">pt_b</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2b_x</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2b_y</span><span class="o">.</span><span class="n">text</span><span class="p">())]</span>
        <span class="n">pt_c</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2c_x</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2c_y</span><span class="o">.</span><span class="n">text</span><span class="p">())]</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2_x_pts</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_2_y_pts</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
    <span class="n">pt_L</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_laser_x</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_laser_y</span><span class="o">.</span><span class="n">text</span><span class="p">())]</span>
    <span class="nb">xrange</span> <span class="o">=</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yrange</span> <span class="o">=</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">imPlot</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">size</span><span class="o">=</span> <span class="o">.</span><span class="mo">01</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="nb">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">size</span><span class="p">,</span> <span class="n">pt_a</span><span class="p">,</span> <span class="n">pt_b</span><span class="p">,</span> <span class="n">pt_c</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">pt_L</span>
</div>
<div class="viewcode-block" id="get_min_max"><a class="viewcode-back" href="../../../src/src.gui.gui_scan_layout.html#src.gui.gui_scan_layout.get_min_max">[docs]</a><span class="k">def</span> <span class="nf">get_min_max</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>
    <span class="n">pta_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_x</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
    <span class="n">ptb_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_x</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
    <span class="n">pta_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1a_y</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
    <span class="n">ptb_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">txt_pt_1b_y</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

    <span class="n">xMin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">pta_x</span><span class="p">,</span> <span class="n">ptb_x</span><span class="p">])</span>
    <span class="n">xMax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">pta_x</span><span class="p">,</span> <span class="n">ptb_x</span><span class="p">])</span>
    <span class="n">yMin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">pta_y</span><span class="p">,</span> <span class="n">ptb_y</span><span class="p">])</span>
    <span class="n">yMax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">pta_y</span><span class="p">,</span> <span class="n">ptb_y</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">xMin</span><span class="p">,</span> <span class="n">xMax</span><span class="p">,</span> <span class="n">yMin</span><span class="p">,</span> <span class="n">yMax</span>

</div>
<div class="viewcode-block" id="exec_scriptBtnClicked"><a class="viewcode-back" href="../../../src/src.gui.gui_scan_layout.html#src.gui.gui_scan_layout.exec_scriptBtnClicked">[docs]</a><span class="k">def</span> <span class="nf">exec_scriptBtnClicked</span><span class="p">(</span><span class="n">ApplicationWindow</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        run script to repeatedly take images and set laser pointer to predefined location</span>
<span class="sd">    &#39;&#39;&#39;</span>


    <span class="n">dirpath</span> <span class="o">=</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">saveLocImage</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">saveTagImage</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H-%M-%S&quot;</span><span class="p">)</span>
    <span class="n">filepath_set</span> <span class="o">=</span> <span class="n">dirpath</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">start_time</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s1">&#39;.set&#39;</span>

    <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">save_settings</span><span class="p">(</span><span class="n">filepath_set</span><span class="p">)</span>


    <span class="n">nr_meas</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nr_meas</span><span class="p">:</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">scanBtnClicked</span><span class="p">()</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">vSetBtnClicked</span><span class="p">()</span>
        <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">saveImageClicked</span><span class="p">()</span>


        <span class="n">waittime</span> <span class="o">=</span> <span class="mi">60</span> <span class="c1"># 1 min</span>
        <span class="k">while</span> <span class="n">waittime</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">waittime</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ApplicationWindow</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s1">&#39;scan {:d}/{:d}: time until next scan: {:d}s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">nr_meas</span><span class="p">,</span> <span class="n">waittime</span><span class="p">),</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</div>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Arthur Safira, Jan Gieseler, Aaron Kabcenell.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>